# Журнал змін

Тут задокументовано всі важливі зміни в **Antigravity SubAgents**.

## [0.0.32] - 2025-12-11

### Виправлено
- **Скрипт відновлення (Claude)** — `resume.sh` тепер дописує до файлу логу та відкриває Термінал з форматованим виводом, так само як `start.sh`

## [0.0.31] - 2025-12-11

### Виправлено
- **Без попередження ESM** — `format-log.js` тепер використовує синтаксис CommonJS для уникнення попереджень про тип модуля Node.js
- **Збільшено ліміт tool_result** — Результати інструментів тепер показують до 300 символів (було 150) для кращого контексту

## [0.0.30] - 2025-12-11

### Змінено
- **Уніфіковане логування в реальному часі** — Claude SubAgents тепер використовують той самий підхід, що й Codex:
  - Записує JSONL до `.subagents/<agent>/sessions/<timestamp>.jsonl`
  - Термінал відкривається з відомим шляхом до файлу (без очікування/пошуку)
  - Використовує `--output-format stream-json --verbose` для потокової передачі в реальному часі
  - Парсить фінальний `result` з JSONL для відповіді оркестратора

## [0.0.29] - 2025-12-11

### Виправлено
- **Логування в реальному часі (Codex)** — stderr тепер передається до файлу логу в реальному часі за допомогою `tee` замість того, щоб виводитися в кінці виконання

### Додано
- **Ізоляція SubAgent** — SubAgents тепер повністю ізольовані від глобальних конфігураційних файлів користувача:
  - **Codex**: Використовує `CODEX_HOME`, що вказує на піддиректорію `.codex` з символічним посиланням на `auth.json`
    - Блокує `~/.codex/AGENTS.md`, зберігаючи автентифікацію
  - **Claude**: Використовує прапорець `--setting-sources ""`
    - Блокує всі файли `CLAUDE.md`, облікові дані з macOS Keychain залишаються доступними
  - Працює з коробки — налаштування користувача не потрібне
  - Гарантує, що SubAgents виконують лише свої специфічні інструкції без успадкування налаштувань Оркестратора або користувача

## [0.0.27] - 2025-12-11 (ЗАМІНЕНО)

### Примітка
Ця версія мала неповну реалізацію ізоляції. Використовуйте v0.0.27 натомість.

## [0.0.25] - 2025-12-10

### Змінено
- **Локальні правила замість глобальних** — Інструкції автоматичної маршрутизації тепер створюють `.agent/rules/subagent-delegation-protocol.md` замість модифікації `~/.gemini/GEMINI.md`.
  - Файл комітиться до git (потрібно для розпізнавання Gemini IDE)
  - Включає фронтматер `trigger: always_on`
  - Видаляється, коли останній SubAgent знімається з деплою

### Виправлено
- **Розпізнавання Gemini IDE** — Файли правил тепер використовують малі літери з дефісами та правильний фронтматер.

## [0.0.23] - 2025-12-09

### Додано
- **Логування в реальному часі (Codex)** — Коли Codex SubAgent запускається, автоматично відкривається вікно Терміналу з повним детальним виводом (роздуми, виклики інструментів, логи виконання). Оркестратор отримує лише фінальну відповідь для економії токенів.
- **Витягування ID сесії (Codex)** — ID сесії тепер витягується з stderr та додається до stdout як `[SESSION_ID: uuid]` для потенційної функціональності відновлення.

### Змінено
- **Спрощений режим Claude** — Claude SubAgents тепер працюють у простому текстовому режимі виводу без логування (Claude CLI не підтримує детальний stderr у режимі print). Відновлення використовує прапорець `--continue`.
- **Умовний Термінал** — Вікно Терміналу з переглядачем логів відкривається лише для Codex, не для Claude.

### Документація
- Додано `doc/Knowledge/Claude_CLI_Logging_Research.md` — детальне дослідження обмежень логування Claude CLI.

## [0.0.14] - 2025-12-09

### Виправлено
- **Чистий вивід Оркестратора** — Додано `2>/dev/null` до всіх команд SubAgent (обидва вендори Codex і Claude)

  **Проблема:** Коли Antigravity Orchestrator викликав SubAgent, він отримував весь потік виводу, включаючи:
  - Внутрішні блоки `thinking` (міркування агента)
  - Логи команд `exec` з повним виводом оболонки
  - Проміжні повідомлення та інформацію для налагодження

  Це забруднювало контекстне вікно оркестратора та ускладнювало парсинг фактичної відповіді SubAgent.

  **Рішення:** Всі команди SubAgent тепер перенаправляють stderr до `/dev/null`, забезпечуючи отримання оркестратором **лише фінальної відповіді** (stdout), а не внутрішніх логів обробки.

- **Перегенерація команд при деплої** — Команди тепер перегенеровуються під час кожної операції деплою

  Раніше команди, збережені в Бібліотеці, використовувалися як є під час деплою. Якщо агент був створений до цього виправлення, його команди все ще не мали `2>/dev/null`. Тепер команди завжди перегенеровуються з централізованого `command-generator.ts`, гарантуючи найновіший формат.

### Додано
- `src/core/command-generator.ts` — Централізований генератор команд для послідовного формату команд у всіх операціях деплою

## [0.0.11] - 2025-12-09

### Змінено
- **Дозволи Codex CLI**: SubAgents тепер використовують прапорець `--dangerously-bypass-approvals-and-sandbox` замість `--sandbox danger-full-access`. Це надає Codex SubAgents повну свободу виконувати будь-які операції без запитів на дозвіл.

## [0.0.10] - 2025-12-08

### Виправлено
- **Термінологія**: Виправлено посилання з "Antigravity (Gemini CLI)" на "Antigravity IDE" у метаданих розширення, UI та коментарях коду для точної ідентифікації продукту.

## [0.0.9] - 2025-12-08

### Змінено
- **Протокол взаємодії з користувачем**: Покращено інструкції для Оркестратора при обробці запитань SubAgent. Тепер використовується пряме спілкування в чаті замість інструменту `notify_user` для кращого UX.

### Обслуговування
- **Очищення**: Видалено тестові файли з репозиторію.
- **Git Ignore**: Додано `CHANGELOG_ru.md` до .gitignore для збереження локалізованих документів локально.

## [0.0.8] - 2025-12-08

### Виправлено
- **Codex CLI**: Видалено недійсний прапорець `-a on-request` зі згенерованих команд запуску. Це виправляє помилку "unexpected argument" при запуску субагентів.

### Змінено
- **Протокол маршрутизації**: Оновлено інструкції автоматичної маршрутизації `GEMINI.md` з новим **ПРОТОКОЛОМ ВЗАЄМОДІЇ**.
- **Команда відновлення**: Пояснено, як обробляти запитання SubAgent за допомогою `commands.resume`.

## [0.0.7] - 2025-12-08

### Змінено
- **Маршрутизація SubAgent**: Впроваджено строгий протокол "Сканування можливостей". Запобігає виконанню Оркестратором ручної роботи, якщо існує відповідний SubAgent.

## [0.0.6] - 2025-12-08

### Змінено
- **Іконки**: Оновлено іконки розширення (логотип).

## [0.0.5] - 2025-12-08

### Документація
- **Передумови**: Додано розділ з описом вимоги встановленого та автентифікованого **Codex CLI** та **Claude Code CLI**.

## [0.0.4] - 2025-12-08

### Документація
- **Уточнення**: Уточнено `README` для правильної ідентифікації **Antigravity** як IDE та Main Agents як **Оркестраторів**.
- **Можливості**: Виділено "Фокусоване виконання" як ключову перевагу — Sub-Agents працюють лише з вузькими інструкціями.

## [0.0.3] - 2025-12-08

### Документація
- **README**: Повністю переписано для відображення нової архітектури **Antigravity Orchestrator**.
- **Переклад**: Оновлено `README_ru.md` з точною російською документацією.

## [0.0.2] - 2025-12-08

### Виправлено
- **Дозволи пісочниці**: Sub-Agents тепер працюють з `danger-full-access` для дозволу створення файлів у корені проекту.
- **Маніфест**: Оновлено конфігурацію агента `translator` за замовчуванням.

## [0.0.1] - 2025-12-08

### Додано
- **Перший реліз** Antigravity SubAgents!
- **Підтримка Оркестратора**: Перетворює Antigravity (Gemini CLI) на потужний Оркестратор.
- **Автоматична маршрутизація**: Автоматично вставляє інструкції маршрутизації до `~/.gemini/GEMINI.md`.
- **Генерація воркфлоу**: Створює Slash Commands для Antigravity у `.agent/workflows/` (Проект) та `~/.gemini/antigravity/global_workflows/` (Глобально).
- **Підтримка Sub-Agent**: Створення та керування Sub-Agents, що виконуються **Codex CLI** або **Claude Code CLI**.
- **UI**: VS Code Webview для візуального керування агентами (Створення, Редагування, Деплой, Бібліотека).
